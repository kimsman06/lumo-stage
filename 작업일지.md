# LumoStage 개발 작업 일지 (2025년 9월 2일)

## 1. 로테이션 기능 및 헬퍼 구현 시도 및 롤백

### 문제점
- `rotation`, `distance`, `decay` 속성 추가 및 UI 연동 시도.
- `SpotLightHelper`, `DirectionalLightHelper` 구현 중 `node_modules` 관련 임포트 오류 발생 (`TypeError: Cannot read properties of undefined (reading 'elements')`, `Uncaught SyntaxError: ... does not provide an export named 'DirectionalLightHelper'`).
- `SpotLight`의 `target` 설정 방식 문제로 인한 렌더링 오류 발생.
- 사용자 요청에 따라 해당 기능 전체 롤백 결정.

### 해결 과정
- `store.js`: `rotation`, `distance`, `decay` 속성 및 관련 로직 추가/제거 반복.
- `Controls.jsx`: `rotation`, `distance`, `decay` UI 추가/제거 반복.
- `Scene.jsx`:
    - `SpotLightHelper`, `DirectionalLightHelper` 임포트 및 `extend` 시도 (from `three` 및 `@react-three/drei`).
    - `SpotLight`의 `target` 속성 처리 방식 변경 시도 (임시 `Object3D` 생성 및 연결).
    - `TypeError` 발생 시 `console.log`를 통한 디버깅 시도.
    - 최종적으로 `git reset --hard`를 통해 로테이션 기능 구현 시도 이전 상태로 롤백.
- `vite.config.js`: `optimizeDeps.include` 설정 추가/제거 반복.

### 결과
- 로테이션 기능 및 헬퍼 구현 시도 이전 상태로 성공적으로 롤백 완료.
- `git reset --hard`를 통해 안정적인 이전 커밋으로 복구.

## 2. 컨트롤러 조작 미반영 버그 디버깅 및 해결

### 문제점
- 컨트롤 패널(UI)에서 조명 속성(색상, 강도, 위치)을 변경해도 3D Scene에 반영되지 않는 문제 발생.
- 반면, 3D Scene에서 직접 조작(TransformControls) 시에는 정상 작동.

### 해결 과정
- `store.js`의 `updateLight`, `updateLightPosition` 함수에 `console.log` 추가하여 스토어 업데이트 확인.
- `Scene.jsx`에 `console.log` 추가하여 스토어 상태 수신 및 리렌더링 확인.
- **원인 파악:** `Scene.jsx`에서 `SpotLight`의 `target` 속성을 `Object3D`로 연결하는 과정에서 `TypeError`가 발생하여 렌더링 파이프라인이 중단되었던 것으로 추정. (이전 로테이션 기능 구현 시도 중 발생했던 문제와 동일한 근원)
- **해결:** `Scene.jsx`에서 `SpotLight` 및 `DirectionalLight`의 `target` 속성을 안정적인 `THREE.Object3D` 인스턴스에 연결하도록 수정. (이 `Object3D`는 `useRef`로 생성하고 `Canvas` 내부에 `primitive`로 렌더링하여 Scene Graph에 포함되도록 함.)
- 디버깅용 `console.log` 제거.

### 결과
- 컨트롤 패널에서 조명 속성 변경 시 3D Scene에 정상적으로 반영됨을 확인.
- `TypeError` 해결 및 애플리케이션 정상 작동 확인.

## 3. 기타 작업
- `App.jsx`에서 디버깅용 Roughness 값 표시 제거.
