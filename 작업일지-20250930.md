# 작업일지 - 2025년 9월 30일

## 1. 주요 작업 요약

지난 몇 시간 동안 다음과 같은 기능의 구현 및 개선을 시도했습니다.

- **마네킹 모델 도입**: 장면에 있던 기본 구(Sphere)를 리깅된 3D 나무 마네킹 모델로 교체했습니다.
- **UI 패널 통합**: 화면 좌우에 분산되어 있던 컨트롤 패널을 우측의 단일 패널로 통합하고, 내부에 `Mannequin`, `Lighting`, `Scene` 탭을 두어 UI 복잡도를 개선했습니다.
- **다중 마네킹 기능**: 여러 개의 마네킹을 장면에 추가, 선택, 삭제하는 기능을 구현했습니다.
- **포즈 프리셋**: '서기', '앉기' 등 미리 정의된 포즈를 버튼으로 적용하는 기능을 구현했습니다.
- **조명 개선**: 기본 조명 환경을 3점 조명 방식으로 개선하여 시각적 품질을 높였습니다.
- **직접 조작 기능 (시도)**: 마네킹/관절 선택, 기즈모를 이용한 이동/회전 등 다양한 직접 조작 기능을 구현 시도했습니다.

---

## 2. 주요 이슈 및 디버깅 과정

복잡한 기능을 구현하는 과정에서 다음과 같은 심각한 버그들이 발생했으며, 장시간에 걸쳐 해결을 시도했습니다.

1.  **IK(Inverse Kinematics) 기능 구현 실패**
    - **문제**: `CCDIKSolver` 라이브러리를 사용하여 IK 기능을 구현하려 했으나, React 컴포넌트의 렌더링 생명주기와 Three.js 객체의 내부 골격 구조가 준비되는 시점 간의 충돌로 인해 `Cannot read properties of undefined (reading 'parent')` 오류가 지속적으로 발생했습니다.
    - **시도**: `useEffect`, `useMemo`, `useFrame`, `ref` 등 다양한 훅을 이용해 초기화 시점을 늦추는 방법을 모두 시도했으나, 근본적인 호환성 문제를 해결하지 못했습니다.
    - **결론**: 현 구조에서 해당 라이브러리를 안정적으로 사용하는 것은 불가능하다고 판단, 관련 기능 구현을 포기하고 코드 원상 복구를 결정했습니다.

2.  **모델 방향 오류 (눕는 현상)**
    - **문제**: 슬라이더, 기즈모 등으로 마네킹의 포즈를 코드로 제어할 때, 모델의 기본 방향을 설정하는 회전 값이 무시되어 마네킹이 눕는 현상이 반복적으로 발생했습니다.
    - **원인**: `useFrame` 또는 `useEffect` 내부의 포즈 적용 로직이 모델의 루트 회전과 충돌을 일으켰습니다.
    - **결론**: 이 문제를 해결하기 위한 여러 시도가 또 다른 연쇄적인 버그를 발생시켜, 프로젝트의 안정성을 크게 저하시키는 원인이 되었습니다.

---

## 3. 현재 상태

- 사용자의 **Git 롤백**을 통해, 위와 같은 심각한 버그들이 발생하기 이전의 **안정적인 버전**으로 코드가 되돌아갔습니다.
- 정확한 시점은 알 수 없으나, 최소한 **[단일 패널 UI]** 와 **[다중 마네킹]**, **[포즈 프리셋]** 등의 기능이 정상적으로 작동하던 시점으로 추정됩니다.

---

## 4. 향후 추천 작업 (Roadmap)

잦은 버그로 인해 개발 경험을 해친 점을 반성하며, 앞으로는 **안정성을 최우선**으로 고려한 점진적인 개발 계획을 제안합니다.

1.  **(필수) 기본 자세 안정화**: 가장 먼저, 가장 간단하고 확실한 방법으로 마네킹의 기본 자세를 **똑바로 선 T-포즈**로 설정하는 작업을 다시 진행합니다. (복잡한 로직 없이, `store.js`의 초기 값만 수정)

2.  **마네킹 이동 기능**: 안정화된 T-포즈 위에서, 이전에 비교적 안정적으로 작동했던 **마네킹 전체 이동 기즈모** 기능을 다시 구현합니다.

3.  **점진적 기능 추가**: 안정성이 확보되면, 아래 기능들을 순서대로 추가하는 것을 제안합니다.
    - **더 많은 포즈 프리셋 추가**: '걷는 자세', '뛰는 자세' 등 다양한 프리셋을 추가합니다.
    - **카메라 저장/로드**: 현재 카메라의 위치와 바라보는 방향을 저장하고, 다시 불러오는 기능을 추가합니다.
    - **씬(Scene) 저장/로드**: 현재 조명과 마네킹들의 모든 상태를 하나의 파일로 저장하고 불러오는 기능을 구현합니다. (이전 PRD의 Phase 3 내용)

복잡했던 IK나 관절 기즈모 기능은 잠시 보류하고, 위와 같이 안정적인 기능부터 차근차근 추가해 나가는 것이 좋겠습니다.
